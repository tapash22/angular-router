<div class="relative animate-fade-in">
    <div
        class="card my-2 p-4 w-full h-full rounded-2xl"
        [ngClass]="{
          'border-2': selected || (projectCardDisabled || isDisabled),
          'border-[var(--border)]': selected,
          'border-[var(--danger)] cursor-not-allowed pointer-events-none opacity-35': projectCardDisabled || isDisabled
        }"
        (click)="handleSelectProject()">
        
        <!-- Title Section -->
        <div class="flex justify-between items-center relative">
            <div class="block">
                <h2 class="text-xl font-semibold py-1 text-[var(--foreground)]">
                    {{ project.project_title }}
                </h2>
                
                <!-- Status Badge -->
                <div class="w-full flex items-center justify-start">
                    <p
                        class="px-3 py-1 rounded-sm text-center text-sm font-medium w-auto ring-1 ring-[var(--border)]"
                        [ngClass]="statusClassMap[project.projectStatus] || 'bg-[var(--muted)]/20'"
                        style="color: var(--foreground)">
                        {{ project.projectStatus | titlecase }}
                    </p>
                </div>
            </div>
            
            <!-- Action Button -->
            <ng-container>
                <fa-icon
                    [icon]="(icon && !isDisabled) ? icon : iconBarChart"
                    class="text-lg cursor-pointer rounded-md transition-all duration-200 hover:scale-110"
                    style="color: var(--primary)"
                    (click)="(icon && !isDisabled) ? handleEditProject($event) : openProjectChart()">
                </fa-icon>
            </ng-container>
        </div>
        
        <!-- Subtitle -->
        <p class="text-lg font-normal py-3 text-[var(--foreground)]">
            {{project.project_subtitle}}
        </p>

        <!-- Requirements Chips -->
        <div
            class="w-full flex items-center gap-2 h-24 overflow-x-auto overflow-y-hidden px-2 custom-scrollbar-x"
            *ngIf="project.project_requirement.length">
            <p
                class="flex items-center justify-center whitespace-nowrap rounded-xl text-sm font-medium px-4 py-2 shadow bg-[var(--surface)]"
                style="color: var(--foreground)"
                *ngFor="let chip of project.project_requirement">
                {{ chip }}
            </p>
        </div>

        <!-- User Engagement -->
        <div class="w-full h-auto block items-center gap-2 py-2">
            <p class="text-lg font-normal text-[var(--foreground)]">
                User Engaged: {{project.working_resource.length}}
            </p>
        </div>

        <!-- Resources Section -->
        <div class="chart-container w-auto h-32">
            <div class="grid grid-cols-2 gap-3">
                <div class="p-3 shadow bg-[var(--surface)]" *ngFor="let resource of project.working_resource">
                    <h2 class="text-sm flex justify-center w-full font-medium tracking-wide py-1 text-[var(--foreground)]">
                        {{resource.name}}
                    </h2>
                    <div class="w-full h-auto" [ngClass]="resource.performance_score > 10 ? 'block' : 'hidden'">
                        <!-- Progress bar with tooltip -->
                        <div class="w-full rounded-full h-3 my-2 flex items-center group bg-[var(--border)]">
                            <div
                                class="h-3 rounded-full transition-all duration-500 flex justify-center items-center relative"
                                [style.width.%]="resource.performance_score"
                                style="background: var(--primary)">
                                <span class="absolute -top-6 z-30 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-xs px-2 py-1 rounded"
                                      style="color: var(--foreground); background-color: var(--surface)">
                                    {{ resource.performance_score }}%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dialog Container -->
    <ng-container *ngIf="isDialogVisible">
        <app-dynamic-dialog
            [title]="'Project Overview'"
            [size]="'md'"
            [show]="isDialogVisible"
            [disableClose]="false"
            (onClose)="closeDialog()">
            <div class="chart-container">
                <app-overview-chart
                    [type]="doughnutChartConfig.type"
                    [data]="doughnutChartConfig.data"
                    [options]="doughnutChartConfig.options">
                </app-overview-chart>
            </div>
        </app-dynamic-dialog>
    </ng-container>
</div>